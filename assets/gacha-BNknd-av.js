import"./modulepreload-polyfill-B5Qt9EMX.js";const x=document.getElementById("c"),e=x.getContext("2d"),T={bg:"#CC0000",pullThreshold:150,burstDuration:1.2,revealDuration:2},_="福禄寿喜财富贵发金玉宝余丰盛利旺隆昌兴进安康宁泰和平顺健乐欢庆禧祺嘉春德善仁义忠信孝慧恩爱合圆满美馨雅吉祥瑞如意祝运龙凤麟鹤华成升登高",Be={一:{phrase:"一帆风顺",english:"Smooth sailing in all endeavors"},人:{phrase:"人寿年丰",english:"Long life and abundant harvests"},十:{phrase:"十全十美",english:"Perfection in every way"},大:{phrase:"大吉大利",english:"Great luck and great profit"},吉:{phrase:"吉祥如意",english:"Good fortune as you wish"},平:{phrase:"四季平安",english:"Peace through all four seasons"},安:{phrase:"岁岁平安",english:"Peace and safety year after year"},和:{phrase:"和气生财",english:"Harmony brings prosperity"},春:{phrase:"春风得意",english:"Success on the spring breeze"},利:{phrase:"开岁大利",english:"Great profit in the new year"},兴:{phrase:"兴旺发达",english:"Flourishing and thriving"},旺:{phrase:"人丁兴旺",english:"A growing and prosperous family"},发:{phrase:"恭喜发财",english:"Wishing you great prosperity"},金:{phrase:"金玉满堂",english:"Gold and jade fill the hall"},贵:{phrase:"荣华富贵",english:"Glory, splendor, and riches"},富:{phrase:"富贵有余",english:"Wealth and abundance to spare"},财:{phrase:"财源广进",english:"Wealth flowing from all directions"},寿:{phrase:"福寿双全",english:"Both blessings and longevity"},禄:{phrase:"高官厚禄",english:"High rank and generous reward"},喜:{phrase:"双喜临门",english:"Double happiness at the door"},龙:{phrase:"龙马精神",english:"The vigor of dragons and horses"},凤:{phrase:"龙凤呈祥",english:"Dragon and phoenix bring fortune"},福:{phrase:"福星高照",english:"The star of fortune shines bright"},玉:{phrase:"金玉良缘",english:"A golden and jade match"},宝:{phrase:"招财进宝",english:"Inviting wealth and treasures"},余:{phrase:"年年有余",english:"Abundance year after year"},丰:{phrase:"五谷丰登",english:"A bountiful harvest"},盛:{phrase:"繁荣昌盛",english:"Flourishing and prosperous"},隆:{phrase:"生意兴隆",english:"Business booming and thriving"},昌:{phrase:"繁荣昌盛",english:"Prosperity and flourishing"},进:{phrase:"招财进宝",english:"Welcoming wealth and treasure"},康:{phrase:"健康长寿",english:"Health and longevity"},宁:{phrase:"宁静致远",english:"Serenity leads to greatness"},泰:{phrase:"国泰民安",english:"A prosperous and peaceful nation"},顺:{phrase:"万事顺利",english:"Everything goes smoothly"},健:{phrase:"身体健康",english:"Good health and vitality"},乐:{phrase:"快乐无忧",english:"Joy and freedom from worry"},欢:{phrase:"合家欢乐",english:"Family happiness and joy"},庆:{phrase:"普天同庆",english:"All the world celebrates together"},禧:{phrase:"恭贺新禧",english:"Happy New Year greetings"},祺:{phrase:"吉祥安祺",english:"Auspicious blessings of peace"},嘉:{phrase:"嘉年华庆",english:"A grand festive celebration"},德:{phrase:"厚德载物",english:"Great virtue carries all things"},善:{phrase:"善气迎人",english:"Kindness welcomes all"},仁:{phrase:"仁者无敌",english:"The benevolent are invincible"},义:{phrase:"义薄云天",english:"Righteousness reaching the sky"},忠:{phrase:"忠义千秋",english:"Loyalty and honor through the ages"},信:{phrase:"信誉天下",english:"Trust and honor across the land"},孝:{phrase:"百善孝为先",english:"Filial piety is the root of virtue"},慧:{phrase:"聪慧过人",english:"Wisdom beyond measure"},恩:{phrase:"恩重如山",english:"Gratitude deep as the mountains"},爱:{phrase:"爱满人间",english:"Love fills the world"},合:{phrase:"百年好合",english:"A lifetime of harmony"},圆:{phrase:"花好月圆",english:"Blooming flowers and full moon"},满:{phrase:"满堂红光",english:"Red radiance fills the hall"},美:{phrase:"美满幸福",english:"Bliss and happiness"},馨:{phrase:"温馨如意",english:"Warm and fulfilling"},雅:{phrase:"典雅脱俗",english:"Elegance beyond the ordinary"},祥:{phrase:"吉祥如意",english:"Auspicious and as you wish"},瑞:{phrase:"瑞气盈门",english:"Auspicious energy at your door"},如:{phrase:"万事如意",english:"May everything go as you wish"},意:{phrase:"称心如意",english:"Everything to your heart's desire"},祝:{phrase:"祝福满满",english:"Overflowing with blessings"},运:{phrase:"鸿运当头",english:"Great fortune is upon you"},麟:{phrase:"凤毛麟角",english:"Rare and precious as a phoenix feather"},鹤:{phrase:"松鹤延年",english:"Pine and crane for longevity"},华:{phrase:"华夏瑞年",english:"An auspicious year for China"},成:{phrase:"马到成功",english:"Success upon arrival"},升:{phrase:"步步高升",english:"Rising higher with every step"},登:{phrase:"登峰造极",english:"Reaching the very peak"},高:{phrase:"高朋满座",english:"Distinguished guests fill every seat"}},ce=['"Zhi Mang Xing"','"Liu Jian Mao Cao"','"Ma Shan Zheng"','"TsangerZhoukeZhengdabangshu"','"hongleixingshu"','"qiantubifengshouxieti"','"峄山碑篆体"'],Ae=[{name:"五福",nameEn:"Five Blessings",chars:"福禄寿喜财",r:255,g:45,b:45},{name:"财富",nameEn:"Wealth",chars:"财富贵发金玉宝余丰盛利旺",r:255,g:215,b:0},{name:"平安",nameEn:"Peace",chars:"安康宁泰和平顺健",r:0,g:255,b:159},{name:"喜庆",nameEn:"Joy",chars:"喜乐欢庆禧祺嘉春",r:255,g:120,b:80},{name:"德行",nameEn:"Virtue",chars:"德善仁义忠信孝慧恩",r:255,g:200,b:50},{name:"爱情",nameEn:"Love",chars:"爱合圆满美馨雅",r:255,g:130,b:180},{name:"吉祥",nameEn:"Auspicious",chars:"吉祥瑞如意祝运",r:180,g:255,b:80},{name:"神话",nameEn:"Mythical",chars:"龙凤麟鹤华",r:255,g:180,b:50},{name:"成就",nameEn:"Achievement",chars:"成升登高",r:80,g:220,b:255}],xe=[{stars:6,label:"天赐鸿福",labelEn:"Heavenly Fortune",categories:[0],color:"#FFD700",glow:"rgba(255,215,0,0.5)",burstRGB:[255,215,0]},{stars:5,label:"吉星高照",labelEn:"Auspicious Stars",categories:[7,8],color:"#FFA500",glow:"rgba(255,165,0,0.5)",burstRGB:[255,180,50]},{stars:4,label:"福泽绵长",labelEn:"Enduring Blessings",categories:[4,5],color:"#FF69B4",glow:"rgba(255,105,180,0.5)",burstRGB:[255,130,180]},{stars:3,label:"万事如意",labelEn:"All Wishes Fulfilled",categories:[2,6],color:"#00FF9F",glow:"rgba(0,255,159,0.5)",burstRGB:[0,255,159]},{stars:2,label:"迎春纳福",labelEn:"Welcoming Fortune",categories:[1,3],color:"#FF6644",glow:"rgba(255,102,68,0.5)",burstRGB:[255,120,80]}],te=[3,7,15,25,50];function fe(t,n,a){return t+(n-t)*a}function v(t,n,a){return t<n?n:t>a?a:t}function Ce(t){return t<.5?2*t*t:-1+(4-2*t)*t}function ge(t){return 1+--t*t*((1.7+1)*t+1.7)}function Le(t){return t===0||t===1?t:Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1}let q,u,g,h,A;function ue(){q=Math.min(window.devicePixelRatio||1,2),u=window.innerWidth,g=window.innerHeight,x.width=u*q,x.height=g*q,h=Math.min(u,g),A=h*.22}ue();window.addEventListener("resize",ue);const R=ce[Math.floor(Math.random()*ce.length)],Re="乾坤离坎震巽艮兑天地风雷水火山泽",ne=[];function ke(){const t=Math.floor(u*g/18e3);for(let n=0;n<t;n++)ne.push({x:Math.random()*u,y:Math.random()*g,char:_[Math.floor(Math.random()*_.length)],size:10+Math.random()*14,alpha:.04+Math.random()*.06,vy:-.15-Math.random()*.25,vx:(Math.random()-.5)*.1,phase:Math.random()*Math.PI*2})}ke();function De(){for(const t of ne)t.y+=t.vy,t.x+=t.vx+Math.sin(P*.3+t.phase)*.05,t.y<-20&&(t.y=g+20,t.x=Math.random()*u,t.char=_[Math.floor(Math.random()*_.length)])}function Te(){e.save(),e.textAlign="center",e.textBaseline="middle";for(const t of ne)e.globalAlpha=t.alpha,e.font=`${t.size}px serif`,e.fillStyle="#FFD700",e.fillText(t.char,t.x,t.y);e.restore()}function Fe(){e.save(),e.globalAlpha=.03,e.fillStyle="#000";for(let t=0;t<g;t+=4)e.fillRect(0,t,u,1);e.restore()}const N=[];function Ge(t,n,a){const r=40+a.stars*12,[s,o,i]=a.burstRGB;for(let y=0;y<r;y++){const p=Math.PI*2*y/r+(Math.random()-.5)*.6,m=4+Math.random()*10;N.push({x:t,y:n,vx:Math.cos(p)*m,vy:Math.sin(p)*m-3,char:_[Math.floor(Math.random()*_.length)],r:s,g:o,b:i,life:.8+Math.random()*.5,decay:.008+Math.random()*.012,gravity:.06+Math.random()*.04,drag:.985,size:14+Math.random()*12,rotation:Math.random()*Math.PI*2,rotSpeed:(Math.random()-.5)*.12})}}function We(){let t=0;for(let n=0;n<N.length;n++){const a=N[n];a.vx*=a.drag,a.vy*=a.drag,a.vy+=a.gravity,a.x+=a.vx,a.y+=a.vy,a.life-=a.decay,a.rotation+=a.rotSpeed,a.life>0&&(N[t++]=a)}N.length=t}function Ne(){for(const t of N){const n=t.life*t.life;e.save(),e.translate(t.x,t.y),e.rotate(t.rotation),e.globalAlpha=n,e.font=`${t.size}px serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=`rgb(${t.r}, ${t.g}, ${t.b})`,e.shadowColor=`rgba(${t.r}, ${t.g}, ${t.b}, ${n*.6})`,e.shadowBlur=t.size*.6,e.fillText(t.char,0,0),e.restore()}}const U=[];function K(t,n,a,r){const s=Math.random()*Math.PI*2,o=a*(.8+Math.random()*.4);U.push({x:t+Math.cos(s)*o,y:n+Math.sin(s)*o,life:.5+Math.random()*.5,decay:.015+Math.random()*.01,size:1.5+Math.random()*2.5,color:r})}function Ue(){let t=0;for(let n=0;n<U.length;n++){const a=U[n];a.life-=a.decay,a.life>0&&(U[t++]=a)}U.length=t}function Oe(){for(const t of U){const n=t.life>.5?1:t.life*2;e.save(),e.globalAlpha=n*.8,e.fillStyle=t.color,e.shadowColor=t.color,e.shadowBlur=6,e.beginPath();const a=t.size,r=a*.3;for(let s=0;s<8;s++){const o=Math.PI*2*s/8-Math.PI/2,i=s%2===0?a:r,y=t.x+Math.cos(o)*i,p=t.y+Math.sin(o)*i;s===0?e.moveTo(y,p):e.lineTo(y,p)}e.closePath(),e.fill(),e.restore()}}let F=null;function Ye(t,n){F=[];const a=12;for(let r=0;r<a;r++){const s=Math.PI*2*r/a,o=3+Math.random()*5;F.push({x:t,y:n,vx:Math.cos(s)*o,vy:Math.sin(s)*o-1,startAngle:s-Math.PI/a,endAngle:s+Math.PI/a,radius:A*(.7+Math.random()*.5),rot:0,rotV:(Math.random()-.5)*.06,alpha:1,lineW:1+Math.random()*1.5})}}function _e(){if(F){for(const t of F)t.x+=t.vx,t.vy+=.08,t.y+=t.vy,t.rot+=t.rotV,t.alpha-=.012;F[0].alpha<=0&&(F=null)}}function ze(){if(F)for(const t of F)t.alpha<=0||(e.save(),e.translate(t.x,t.y),e.rotate(t.rot),e.globalAlpha=t.alpha,e.strokeStyle="#FFD700",e.lineWidth=t.lineW,e.shadowColor="rgba(255,215,0,0.5)",e.shadowBlur=8,e.beginPath(),e.arc(0,0,t.radius,t.startAngle,t.endAngle),e.stroke(),e.restore())}function pe(t,n,a,r){const s=A,o=.3,i=1+a*8,y=r*o*i,p=-r*o*.6*i,m=r*o*.4*i,c=.4+a*.6,$=.85+.15*Math.sin(r*2.5);e.save(),e.translate(t,n);const C=e.createRadialGradient(0,0,s*.1,0,0,s*1.5);C.addColorStop(0,`rgba(255, 215, 0, ${.12*c*$})`),C.addColorStop(.5,`rgba(255, 100, 0, ${.06*c})`),C.addColorStop(1,"rgba(255, 50, 0, 0)"),e.fillStyle=C,e.fillRect(-s*1.5,-s*1.5,s*3,s*3),e.save(),e.rotate(y),e.strokeStyle=`rgba(255, 215, 0, ${.6*c})`,e.lineWidth=2,e.shadowColor=`rgba(255, 215, 0, ${.5*c})`,e.shadowBlur=12,e.beginPath(),e.arc(0,0,s,0,Math.PI*2),e.stroke(),e.lineWidth=1.5;for(let l=0;l<36;l++){const d=Math.PI*2*l/36,b=l%3===0?s-12:s-7;e.beginPath(),e.moveTo(Math.cos(d)*b,Math.sin(d)*b),e.lineTo(Math.cos(d)*s,Math.sin(d)*s),e.stroke()}e.shadowBlur=6,e.font=`${s*.1}px serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=`rgba(255, 215, 0, ${.5*c})`;for(let l=0;l<8;l++){const d=Math.PI*2*l/8,b=s+s*.12;e.save(),e.translate(Math.cos(d)*b,Math.sin(d)*b),e.rotate(d+Math.PI/2),e.fillText(Re[l],0,0),e.restore()}e.restore();const D=s*.78;e.save(),e.rotate(p),e.strokeStyle=`rgba(255, 200, 50, ${.45*c})`,e.lineWidth=1.5,e.shadowColor=`rgba(255, 215, 0, ${.3*c})`,e.shadowBlur=8,e.beginPath(),e.arc(0,0,D,0,Math.PI*2),e.stroke(),e.setLineDash([8,12]),e.beginPath(),e.arc(0,0,D*.92,0,Math.PI*2),e.stroke(),e.setLineDash([]);for(let l=0;l<6;l++){const d=Math.PI*2*l/6;e.beginPath(),e.arc(Math.cos(d)*D,Math.sin(d)*D,3,0,Math.PI*2),e.fillStyle=`rgba(255, 215, 0, ${.6*c})`,e.fill()}e.restore();const L=s*.58;e.save(),e.rotate(m),e.strokeStyle=`rgba(255, 215, 0, ${.55*c})`,e.lineWidth=1.5,e.shadowColor=`rgba(255, 215, 0, ${.4*c})`,e.shadowBlur=10,e.beginPath();for(let l=0;l<3;l++){const d=Math.PI*2*l/3-Math.PI/2,b=Math.cos(d)*L,E=Math.sin(d)*L;l===0?e.moveTo(b,E):e.lineTo(b,E)}e.closePath(),e.stroke(),e.beginPath();for(let l=0;l<3;l++){const d=Math.PI*2*l/3+Math.PI/2,b=Math.cos(d)*L,E=Math.sin(d)*L;l===0?e.moveTo(b,E):e.lineTo(b,E)}e.closePath(),e.stroke();const O=L*.5;e.strokeStyle=`rgba(255, 180, 0, ${.35*c})`,e.lineWidth=1,e.beginPath();for(let l=0;l<6;l++){const d=Math.PI*2*l/6,b=Math.cos(d)*O,E=Math.sin(d)*O;l===0?e.moveTo(b,E):e.lineTo(b,E)}e.closePath(),e.stroke(),e.restore();const M=s*.32;e.strokeStyle=`rgba(255, 215, 0, ${.5*c})`,e.lineWidth=1.5,e.shadowColor=`rgba(255, 215, 0, ${.4*c})`,e.shadowBlur=10,e.beginPath(),e.arc(0,0,M,0,Math.PI*2),e.stroke();const H=.9+.1*Math.sin(r*1.8),X=s*.42*H;e.font=`${X}px ${R}, serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=`rgba(255, 215, 0, ${.75*c*$})`,e.shadowColor=`rgba(255, 215, 0, ${.6*c})`,e.shadowBlur=25,e.fillText("福",0,0),e.globalAlpha=.3*c,e.shadowBlur=50,e.fillText("福",0,0),e.globalAlpha=1;const J=e.createRadialGradient(0,0,0,0,0,M);J.addColorStop(0,`rgba(255, 240, 200, ${.15*c*$})`),J.addColorStop(.5,`rgba(255, 215, 0, ${.05*c})`),J.addColorStop(1,"rgba(255, 215, 0, 0)"),e.fillStyle=J,e.fillRect(-M,-M,M*2,M*2);const we=s*.9,Q="福禄寿喜财吉";e.save(),e.rotate(r*.15*i),e.font=`${s*.07}px ${R}, serif`,e.textAlign="center",e.textBaseline="middle";for(let l=0;l<Q.length;l++){const d=Math.PI*2*l/Q.length,b=we+Math.sin(r*1.5+l)*5,E=Math.cos(d)*b,j=Math.sin(d)*b;e.fillStyle=`rgba(255, 215, 0, ${.35*c})`,e.shadowColor="rgba(255,215,0,0.3)",e.shadowBlur=8,e.fillText(Q[l],E,j)}if(e.restore(),a>.5){const l=(a-.5)*2,d=Math.floor(3+l*6);e.save(),e.strokeStyle=`rgba(255, 255, 200, ${l*.7})`,e.lineWidth=1+l*2,e.shadowColor=`rgba(255, 255, 200, ${l*.5})`,e.shadowBlur=15;for(let b=0;b<d;b++){const E=b*137.508,j=E%(Math.PI*2),ee=M*.5,Pe=M+(s-M)*l*(.5+(Math.sin(E)*.5+.5)*.5);e.beginPath(),e.moveTo(Math.cos(j)*ee,Math.sin(j)*ee);const le=4;for(let V=1;V<=le;V++){const $e=V/le,ie=fe(ee,Pe,$e),Ee=Math.sin(E*V*3.7)*.15,he=j+Ee;e.lineTo(Math.cos(he)*ie,Math.sin(he)*ie)}e.stroke()}e.restore()}e.restore()}function He(t,n,a,r){if(a<.1||!r)return;const s=v((a-.1)/.9,0,1),[o,i,y]=r.burstRGB;e.save(),e.globalCompositeOperation="lighter";const p=e.createRadialGradient(t,n,0,t,n,A*(.8+s*.5));if(p.addColorStop(0,`rgba(${o}, ${i}, ${y}, ${s*.5})`),p.addColorStop(.3,`rgba(${o}, ${i}, ${y}, ${s*.25})`),p.addColorStop(.7,`rgba(255, 255, 255, ${s*.06})`),p.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=p,e.beginPath(),e.arc(t,n,A*1.3,0,Math.PI*2),e.fill(),s>.3){const m=(s-.3)/.7,c=Math.floor(8+m*12);for(let $=0;$<c;$++){const C=Math.PI*2*$/c+P*.5,D=A*(.5+m*1.2),L=1+m*2;e.save(),e.translate(t,n),e.rotate(C),e.globalAlpha=m*(.15+Math.sin(P*3+$)*.1),e.fillStyle=`rgb(${o}, ${i}, ${y})`,e.fillRect(-L/2,A*.3,L,D),e.restore()}}e.restore()}function je(t,n){if(t>1)return;const a=1-t;if(a<=0)return;const[r,s,o]=n.burstRGB;e.save();const i=e.createRadialGradient(u/2,g/2,0,u/2,g/2,h*.8);i.addColorStop(0,`rgba(255, 255, 240, ${a*.95})`),i.addColorStop(.2,`rgba(255, 255, 240, ${a*.6})`),i.addColorStop(.5,`rgba(${r}, ${s}, ${o}, ${a*.4})`),i.addColorStop(1,`rgba(${r}, ${s}, ${o}, 0)`),e.fillStyle=i,e.fillRect(0,0,u,g),e.restore()}function qe(t,n,a,r){const[s,o,i]=r.burstRGB;for(let y=0;y<3;y++){const p=y*.12,m=v((a-p)/.6,0,1);if(m<=0||m>=1)continue;const c=A*(.3+m*2.5),$=(1-m)*.5,C=(1-m)*4+1;e.save(),e.globalAlpha=$,e.strokeStyle=`rgb(${s}, ${o}, ${i})`,e.lineWidth=C,e.shadowColor=`rgba(${s}, ${o}, ${i}, ${$*.8})`,e.shadowBlur=15,e.beginPath(),e.arc(t,n,c,0,Math.PI*2),e.stroke(),e.restore()}}function B(t,n,a,r,s,o,i){s<=0||(e.save(),e.globalAlpha=s,e.font=`${o}px ${i||"sans-serif"}`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=r,e.shadowColor=r,e.shadowBlur=o*.4,e.fillText(t,n,a),e.globalAlpha=s*.5,e.shadowBlur=o*.8,e.fillText(t,n,a),e.restore())}function de(){const t=Math.random()*100;let n=0,a=te.length-1;for(let p=0;p<te.length;p++)if(n+=te[p],t<n){a=p;break}const r=xe[a],s=r.categories[Math.floor(Math.random()*r.categories.length)],o=Ae[s],i=o.chars[Math.floor(Math.random()*o.chars.length)],y=Be[i]||{phrase:i+"运亨通",english:"Fortune and blessings upon you"};return{character:i,blessing:y,category:o,tier:r,tierIndex:a}}function Je(t){let n={};try{n=JSON.parse(localStorage.getItem("gacha_collection")||"{}")}catch{}const a=t.character;n[a]?n[a].count++:n[a]={count:1,firstTime:Date.now(),tierIndex:t.tierIndex};const r={totalDraws:0};try{Object.assign(r,JSON.parse(localStorage.getItem("gacha_stats")||"{}"))}catch{}r.totalDraws++,localStorage.setItem("gacha_collection",JSON.stringify(n)),localStorage.setItem("gacha_stats",JSON.stringify(r))}let I="IDLE",S=0,P=0,ae=0,be=0,f=0,w=null,Z=null,G=null,W=null;function k(t){I=t,be=P,S=0,t==="IDLE"&&(f=0,F=null,N.length=0,U.length=0,w=null,W=null,ot()),t==="PULLING"&&(w=de(),W=w.tier),t==="BURST"&&(w||(w=de()),W=w.tier,Je(w),Ye(u/2,g/2),Ge(u/2,g/2,w.tier)),t==="CARD_DISPLAY"&&rt(w)}function se(){const t=f,n=P,a=.35;Z=()=>{const r=v((P-n)/a,0,1);f=t*(1-Le(r)),r>=1&&(f=0,Z=null,I="IDLE")}}function ye(){if(I!=="IDLE")return;k("PULLING");const t=P,n=.6;G=()=>{const a=v((P-t)/n,0,1);f=Ce(a),a>=1&&(f=1,G=null,k("BURST"))}}function Ve(){Math.random()<.15&&K(u/2,g/2,A*1.1,"#FFD700")}function Ze(){const t=u/2,n=g/2;pe(t,n,0,P);const a=v(P/.8,0,1);B("灵 光 法 阵",t,g*.1,"#FFD700",a,h*.055,`${R}, serif`),B("Fortune Sigil",t,g*.1+h*.045,"rgba(255,215,0,0.5)",a*.6,h*.022,"-apple-system, sans-serif");const r=v((P-1)/.5,0,1),s=.5+.5*Math.sin(P*3);B("↑ 上拉启动法阵 ↑",t,g*.9,"#FFD700",r*(.4+s*.3),h*.032,"-apple-system, sans-serif"),B("Swipe up / Space / Scroll",t,g*.9+h*.035,"rgba(255,215,0,0.35)",r*.3,h*.018,"-apple-system, sans-serif")}function Ke(){if(Z&&Z(),G&&G(),Math.random()<.1+f*.5){const t=W?`rgb(${W.burstRGB.join(",")})`:"#FFD700";K(u/2,g/2,A*(1+f*.5),t)}}function Xe(){const t=u/2,n=g/2;let a=!1;if(f>.5){a=!0;const o=(f-.5)*10;e.save(),e.translate((Math.random()-.5)*o,(Math.random()-.5)*o)}pe(t,n,f,P),He(t,n,f,W),a&&e.restore();const r=A*1.35,s=f*Math.PI*2;if(e.save(),e.globalAlpha=.2,e.strokeStyle="#333",e.lineWidth=3,e.beginPath(),e.arc(t,n,r,0,Math.PI*2),e.stroke(),f>0){e.globalAlpha=.7;const o=W?W.color:"#FFD700";e.strokeStyle=o,e.shadowColor=o,e.shadowBlur=8,e.lineWidth=3,e.beginPath(),e.arc(t,n,r,-Math.PI/2,-Math.PI/2+s),e.stroke()}e.restore()}function Qe(){_e(),S>T.burstDuration&&k("REVEAL")}function et(){const t=u/2,n=g/2,a=w.tier,r=S/T.burstDuration;if(je(S/.25,a),ze(),qe(t,n,r,a),S>T.burstDuration*.4){const s=(S-T.burstDuration*.4)/(T.burstDuration*.6),o=v(s,0,1)*.4,i=h*.25*(3-s*2);B(w.character,t,n,`rgba(${a.burstRGB.join(",")},1)`,o,i,`${R}, serif`)}}function tt(){const t=w.tier;Math.random()<.25&&K(u/2,g/2,h*.2,t.color),S>T.revealDuration&&k("CARD_DISPLAY")}function at(){const t=u/2,n=g/2,a=w.tier,r=w;e.save(),e.globalAlpha=v(S/.3,0,.4),e.fillStyle="#000",e.fillRect(0,0,u,g),e.restore();const s=v(1-S/1.5,0,.3);if(s>0){e.save(),e.globalAlpha=s;const M=e.createRadialGradient(t,n,0,t,n,A);M.addColorStop(0,`rgba(${a.burstRGB.join(",")}, 0.3)`),M.addColorStop(1,"rgba(0,0,0,0)"),e.fillStyle=M,e.beginPath(),e.arc(t,n,A,0,Math.PI*2),e.fill(),e.restore()}const o=v(S/.5,0,1),i=o<1?fe(3,1,ge(o)):1,y=h*.18*i,p=v(S/.3,0,1);B(r.character,t,n-h*.05,"#FFF",p,y,`${R}, serif`);const m=v((S-.4)/.3,0,1);m>0&&(B(r.category.name,t,n-h*.2,a.color,m,h*.035,`${R}, serif`),B(`— ${r.category.nameEn} —`,t,n-h*.16,a.color,m*.5,h*.018,"-apple-system, sans-serif"));const c=v((S-.7)/.3,0,1);c>0&&B(r.blessing.phrase,t,n+h*.1,"#FFD700",c,h*.045,`${R}, serif`);const $=v((S-.9)/.3,0,1);$>0&&B(r.blessing.english,t,n+h*.16,"rgba(255,215,0,0.6)",$*.7,h*.02,"-apple-system, sans-serif");const C=1,D=h*.03,L=n-h*.28;for(let M=0;M<a.stars;M++){const H=v((S-C-M*.1)/.15,0,1);if(H>0){const X=t+(M-(a.stars-1)/2)*D*1.5;B("★",X,L,a.color,H,D*ge(H),"-apple-system, sans-serif")}}const O=v((S-1.5)/.3,0,1);O>0&&(B(a.label,t,n+h*.24,a.color,O*.6,h*.022,`${R}, serif`),B(a.labelEn,t,n+h*.28,a.color,O*.35,h*.015,"-apple-system, sans-serif"))}function nt(){if(Math.random()<.1){const t=w.tier;K(u/2,g/2,h*.25,t.color)}}function st(){e.save(),e.globalAlpha=.5,e.fillStyle="#000",e.fillRect(0,0,u,g),e.restore()}const re=document.getElementById("card-overlay"),Y=re.querySelector(".card-container"),oe=document.getElementById("btn-draw-again"),me=document.getElementById("back-link"),Me=document.getElementById("home-link");function rt(t){const n=t.tier,a=t.category;Y.style.setProperty("--card-color",n.color),Y.style.setProperty("--card-glow",n.glow),Y.style.setProperty("--card-font",`${R}, serif`),document.getElementById("card-stars").textContent="★".repeat(n.stars)+"☆".repeat(6-n.stars),document.getElementById("card-category").textContent=`${a.name} · ${a.nameEn}`;const r=document.getElementById("card-character");r.textContent=t.character,r.style.fontFamily=`${R}, serif`,document.getElementById("card-phrase").textContent=t.blessing.phrase,document.getElementById("card-english").textContent=t.blessing.english,document.getElementById("card-info").textContent=`${n.label} · ${n.labelEn}`,re.classList.add("visible"),Y.style.animation="none",Y.offsetHeight,Y.style.animation="",setTimeout(()=>{oe.style.display="block",me.style.display="block",Me.style.display="block"},600)}function ot(){re.classList.remove("visible"),oe.style.display="none",me.style.display="none",Me.style.display="none"}oe.addEventListener("click",()=>{k("IDLE")});let ve=0,Se=0,z=!1;x.addEventListener("touchstart",t=>{I==="IDLE"&&(ve=t.touches[0].clientY,k("PULLING"),f=0)},{passive:!0});x.addEventListener("touchmove",t=>{if(I==="PULLING"&&!G){const n=ve-t.touches[0].clientY;n>0&&(f=v(n/T.pullThreshold,0,1))}},{passive:!0});x.addEventListener("touchend",()=>{I==="PULLING"&&!G&&(f>=.95?k("BURST"):f>0?se():I="IDLE")},{passive:!0});x.addEventListener("mousedown",t=>{I==="IDLE"&&(Se=t.clientY,z=!0,k("PULLING"),f=0)});x.addEventListener("mousemove",t=>{if(z&&I==="PULLING"&&!G){const n=Se-t.clientY;n>0&&(f=v(n/T.pullThreshold,0,1))}});x.addEventListener("mouseup",()=>{z&&I==="PULLING"&&!G&&(f>=.95?k("BURST"):f>0?se():I="IDLE"),z=!1});x.addEventListener("mouseleave",()=>{z&&I==="PULLING"&&!G&&f>0&&se(),z=!1});window.addEventListener("keydown",t=>{(t.code==="Space"||t.code==="ArrowUp"||t.code==="Enter")&&(t.preventDefault(),I==="IDLE"?ye():I==="CARD_DISPLAY"&&k("IDLE"))});x.addEventListener("wheel",t=>{t.deltaY<-30&&I==="IDLE"&&ye()},{passive:!0});function Ie(t){switch(ae||(ae=t),P=(t-ae)/1e3,S=P-be,e.save(),e.scale(q,q),e.fillStyle=T.bg,e.fillRect(0,0,u,g),De(),Te(),Fe(),We(),Ue(),I){case"IDLE":Ve(),Ze();break;case"PULLING":Ke(),Xe();break;case"BURST":Qe(),et();break;case"REVEAL":tt(),at();break;case"CARD_DISPLAY":nt(),st();break}Ne(),Oe(),e.restore(),requestAnimationFrame(Ie)}requestAnimationFrame(Ie);
