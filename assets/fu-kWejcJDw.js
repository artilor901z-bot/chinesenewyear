import"./modulepreload-polyfill-B5Qt9EMX.js";import{O as De,W as Fe,P as Re,S as Ee,C as Ie,L as se,a as We,b as Xe,A as Be,c as re,d as Pe,V as Ye,I as Ge,e as Rt}from"./three.module-BKgacnDn.js";const Le=`// Particle vertex shader — billboarded instanced quads\r
// Uses instanceMatrix from Three.js InstancedMesh (set via setMatrixAt)\r
\r
attribute vec3 instanceColor;     // RGB normalized 0-1\r
attribute float instanceAlpha;\r
attribute vec2 instanceUV;        // atlas cell UV offset\r
attribute float instanceScale;    // quad size in world units\r
\r
uniform vec2 cellSize;            // UV size of one atlas cell (1/cols, 1/rows)\r
\r
varying vec2 vUv;\r
varying vec3 vColor;\r
varying float vAlpha;\r
\r
void main() {\r
    // Extract world position from instanceMatrix (translation column)\r
    vec4 worldPos = instanceMatrix * vec4(0.0, 0.0, 0.0, 1.0);\r
\r
    // Transform to view space\r
    vec4 mvPosition = modelViewMatrix * worldPos;\r
\r
    // Billboard: expand unit quad in view space (always faces camera)\r
    mvPosition.xy += position.xy * instanceScale;\r
\r
    gl_Position = projectionMatrix * mvPosition;\r
\r
    // Map quad UV (0..1) into this character's atlas cell\r
    vUv = instanceUV + uv * cellSize;\r
    vColor = instanceColor;\r
    vAlpha = instanceAlpha;\r
}\r
`,ke=`// Particle fragment shader — samples character atlas, applies color tint\r
// Atlas: white chars with baked glow on BLACK background (R channel = intensity)\r
// Output: premultiplied alpha for additive blending\r
\r
uniform sampler2D atlas;\r
\r
varying vec2 vUv;\r
varying vec3 vColor;\r
varying float vAlpha;\r
\r
void main() {\r
    float raw = texture2D(atlas, vUv).r;\r
    float intensity = pow(raw, 0.75); // Lift dim glow fringe for softer halo\r
    float alpha = intensity * vAlpha;\r
    if (alpha < 0.01) discard;\r
\r
    // Premultiplied color for additive blending (src + dst)\r
    gl_FragColor = vec4(vColor * alpha, alpha);\r
}\r
`,k=document.getElementById("c"),n=k.getContext("2d"),x={bg:"#990000",glowRed:"#FF2D2D",glowGold:"#FFD700",glowGreen:"#00FF9F",fuExplodeDelay:2,fuRiseDuration:.8,fuShrinkDuration:.8,fuShrinkEndScale:.18,fuCameraPullbackDuration:.45,fuCameraReturnDuration:.7,shellRiseDuration:2.5},Dt=[" ","·","一","人","十","大","吉","平","安","和","春","利","兴","旺","发","金","贵","富","财","寿","禄","喜","龙","凤","福"],L="福禄寿喜财富贵发金玉宝余丰盛利旺隆昌兴进安康宁泰和平顺健乐欢庆禧祺嘉春德善仁义忠信孝慧恩爱合圆满美馨雅吉祥瑞如意祝运龙凤麟鹤华成升登高",Wt={一:{phrase:"一帆风顺",english:"Smooth sailing in all endeavors"},人:{phrase:"人寿年丰",english:"Long life and abundant harvests"},十:{phrase:"十全十美",english:"Perfection in every way"},大:{phrase:"大吉大利",english:"Great luck and great profit"},吉:{phrase:"吉祥如意",english:"Good fortune as you wish"},平:{phrase:"四季平安",english:"Peace through all four seasons"},安:{phrase:"岁岁平安",english:"Peace and safety year after year"},和:{phrase:"和气生财",english:"Harmony brings prosperity"},春:{phrase:"春风得意",english:"Success on the spring breeze"},利:{phrase:"开岁大利",english:"Great profit in the new year"},兴:{phrase:"兴旺发达",english:"Flourishing and thriving"},旺:{phrase:"人丁兴旺",english:"A growing and prosperous family"},发:{phrase:"恭喜发财",english:"Wishing you great prosperity"},金:{phrase:"金玉满堂",english:"Gold and jade fill the hall"},贵:{phrase:"荣华富贵",english:"Glory, splendor, and riches"},富:{phrase:"富贵有余",english:"Wealth and abundance to spare"},财:{phrase:"财源广进",english:"Wealth flowing from all directions"},寿:{phrase:"福寿双全",english:"Both blessings and longevity"},禄:{phrase:"高官厚禄",english:"High rank and generous reward"},喜:{phrase:"双喜临门",english:"Double happiness at the door"},龙:{phrase:"龙马精神",english:"The vigor of dragons and horses"},凤:{phrase:"龙凤呈祥",english:"Dragon and phoenix bring fortune"},福:{phrase:"福星高照",english:"The star of fortune shines bright"}},N=['"Zhi Mang Xing"','"Liu Jian Mao Cao"','"Ma Shan Zheng"','"TsangerZhoukeZhengdabangshu"','"hongleixingshu"','"qiantubifengshouxieti"','"峄山碑篆体"'],_t=N[Math.floor(Math.random()*N.length)];let Et=0,bt=null,qt=0;const Ue=4.5;function zt(){return N[Et]}function Xt(t){const e=N[Et];let r;do r=Math.floor(Math.random()*N.length);while(r===Et&&N.length>1);Et=r,bt={oldFont:e,startTime:f},qt=f}function v(t,e,r){return t+(e-t)*r}function I(t){return t<.5?2*t*t:-1+(4-2*t)*t}const lt=500;function ie(t,e,r,o){const a=o/(o+r);return{screenX:t*a+window.innerWidth/2,screenY:e*a+window.innerHeight/2,scale:a}}function Bt(t,e){return{x:(t-D/2)*h,y:(e-F/2)*h}}let h,D,F,le,ce,ge,Pt,R=Math.min(window.devicePixelRatio||1,2),rt,Yt,ht,b,it={};function pe(){R=Math.min(window.devicePixelRatio||1,2),k.width=window.innerWidth*R,k.height=window.innerHeight*R,k.style.width=window.innerWidth+"px",k.style.height=window.innerHeight+"px";const t=Math.min(window.innerWidth,window.innerHeight);if(h=Math.max(10,Math.floor(t*.028)),D=Math.floor(window.innerWidth/h),F=Math.floor(window.innerHeight/h),le=D*h,ce=F*h,ge=(window.innerWidth-le)/2,Pt=(window.innerHeight-ce)/2,rt){rt.setSize(window.innerWidth,window.innerHeight),rt.setPixelRatio(R);const e=2*Math.atan(window.innerHeight/(2*lt))*(180/Math.PI);ht.fov=e,ht.aspect=window.innerWidth/window.innerHeight,ht.updateProjectionMatrix()}}window.addEventListener("resize",pe);pe();const q=20,xt=20,$=64;function _e(){rt=new Fe({alpha:!0,antialias:!1}),rt.setSize(window.innerWidth,window.innerHeight),rt.setPixelRatio(R);const t=2*Math.atan(window.innerHeight/(2*lt))*(180/Math.PI);ht=new Re(t,window.innerWidth/window.innerHeight,1,3e3),ht.position.set(0,0,lt),ht.lookAt(0,0,0),Yt=new Ee;const e=document.createElement("canvas");e.width=q*$,e.height=xt*$;const r=e.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,e.width,e.height);const o=new Set([...Dt,...L.split(""),...Object.keys(Wt),"·"]);r.font=`bold ${Math.floor($*.7)}px "Courier New", "SF Mono", monospace`,r.textAlign="center",r.textBaseline="middle",r.fillStyle="#FFFFFF",r.shadowColor="white",r.shadowBlur=$*.12;let a=0;o.forEach(w=>{if(a>=q*xt)return;const p=a%q,S=Math.floor(a/q),u=p*$+$/2,T=S*$+$/2;r.fillText(w,u,T),it[w]={u:p/q,v:1-(S+1)/xt},a++});const c=Dt.filter(w=>w!==" ");for(let w=0;w<N.length;w++){r.font=`bold ${Math.floor($*.7)}px ${N[w]}, "Courier New", monospace`;for(const p of c){if(a>=q*xt)break;const S=a%q,u=Math.floor(a/q),T=S*$+$/2,C=u*$+$/2;r.fillText(p,T,C),it[p+"|"+w]={u:S/q,v:1-(u+1)/xt},a++}}const l=new Ie(e);l.magFilter=se,l.minFilter=se;const i=4e3,s=new We(1,1),d=new Xe({uniforms:{atlas:{value:l},cellSize:{value:new Ye(1/q,1/xt)}},vertexShader:Le,fragmentShader:ke,transparent:!0,blending:Pe,blendSrc:re,blendDst:re,blendEquation:Be,depthWrite:!1,depthTest:!1});b=new Ge(s,d,i);const g=new Float32Array(i*3),M=new Float32Array(i),y=new Float32Array(i*2),m=new Float32Array(i);b.geometry.setAttribute("instanceColor",new Rt(g,3)),b.geometry.setAttribute("instanceAlpha",new Rt(M,1)),b.geometry.setAttribute("instanceUV",new Rt(y,2)),b.geometry.setAttribute("instanceScale",new Rt(m,1)),b.frustumCulled=!1,Yt.add(b)}let Gt=[];function He(){Gt=new Array(F*D).fill(null)}function me(t,e,r,o,a,c,l,i){if(t<0||t>=D||e<0||e>=F)return;const s=e*D+t,d=Gt[s];d&&d.depth<=r||(Gt[s]={char:o,r:a,g:c,b:l,alpha:i,depth:r})}function he(t,e,r){const o=document.createElement("canvas"),a=o.getContext("2d"),c=[...t].length,l=e*c,i=e;o.width=l,o.height=i,a.fillStyle="#000",a.fillRect(0,0,l,i),a.fillStyle="#fff",a.textAlign="center",a.textBaseline="middle";const s=r||'"SimSun", "STSong", "Songti SC", "Noto Serif SC", serif';a.font=`bold ${Math.floor(e*.85)}px ${s}`,a.fillText(t,l/2,i/2);const g=a.getImageData(0,0,l,i).data,M=[],y=c>1?2:1;for(let m=0;m<i;m+=y)for(let w=0;w<l;w+=y){const p=(m*l+w)*4,S=g[p]/255;S>.1&&M.push({nx:w/l*2-1,ny:m/i*2-1,brightness:S,aspect:c})}return M}function Ht(t){const e=Math.floor(t*(Dt.length-1));return Dt[Math.max(0,Math.min(e,Dt.length-1))]}function $t(t){const r=Math.floor(45+t*170),o=Math.floor(45-t*45);return{r:255,g:r,b:o}}let jt=[],Ot=!1;Promise.all(N.map(t=>document.fonts.load(`64px ${t}`,"福大吉"))).then(()=>{he("福",64,_t),jt=he("大吉",64),Ot=!0,_e()});let K=[],pt=0,at=!1,ot=-1,Lt="大吉大利",et="大吉大利",vt=!1,kt=0;function de(t){if(K=[],ot=-1,at=!1,wt(),Array.isArray(t)&&t.length>0){K=t.map(o=>({...o})),at=!0,pt=f;return}if(!Ot)return;const e=Math.min(D,F)*.4*h,r=e*.4;for(const o of jt){const a=Math.min(1,o.brightness+.08),c=Ht(a);if(c===" ")continue;const l=$t(a);K.push({baseX:o.nx*e*.5*o.aspect,baseY:o.ny*e*.5,origZ:(Math.random()-.5)*r,char:c,fontIdx:Math.random()<.7?Math.floor(Math.random()*N.length):null,r:l.r,g:l.g,b:l.b,alpha:.3+a*.7,lum:a,phase:Math.random()*Math.PI*2})}pt=f}function $e(t){if(!b)return 0;if(!K.length)return b.count=0,0;const e=Math.min(D,F)*.4*h,r=Math.min(1,(f-pt)/1.2),o=at?1:I(r),a=at?Math.min(1,(f-pt)/.6):1,c=at?0:.5,l=at?1:Math.min(1,Math.max(0,(f-pt-c)/.8)),i=e*.06*l,s=b.geometry.attributes.instanceColor,d=b.geometry.attributes.instanceAlpha,g=b.geometry.attributes.instanceUV,M=b.geometry.attributes.instanceScale,y=s.count,m=Math.min(K.length,y),w=e*.5,p=Math.sin(f*.8)*.3;for(let S=0;S<m;S++){const u=K[S],T=u.origZ*o+Math.sin(f*1.5+u.phase)*i,C=S===ot,W=C?-80:0;Y.position.set(u.baseX,-u.baseY,-(T+W)),Y.updateMatrix(),b.setMatrixAt(S,Y.matrix);let G=u.alpha*Math.max(.2,1.25);G=Math.min(.8,G),C&&(G=1);const _=w>0?u.baseY/w:0,H=Math.max(0,Math.min(1,(_+1)*.5)),dt=Math.abs(_-p),P=Math.max(0,1-dt*3),Vt=Math.min(255,Math.floor(v(255,180,H)+P*55)),A=Math.min(255,Math.floor(v(225,130,H)+P*40)),z=Math.min(255,Math.floor(v(50,10,H)+P*50)),tt=v(u.r,Vt,a)/255,X=v(u.g,A,a)/255,V=v(u.b,z,a)/255;s.setXYZ(S,C?1:tt,C?.97:X,C?.86:V),d.setX(S,G);const E=u.fontIdx!=null&&it[u.char+"|"+u.fontIdx]||it[u.char];E&&g.setXY(S,E.u,E.v);let ct=h*1.1;C&&(ct*=2.2),M.setX(S,ct)}return b.count=m,b.instanceMatrix.needsUpdate=!0,s.needsUpdate=!0,d.needsUpdate=!0,g.needsUpdate=!0,M.needsUpdate=!0,m}const mt=document.createElement("div");Object.assign(mt.style,{position:"fixed",pointerEvents:"none",opacity:"0",transition:"opacity 0.2s ease",background:"rgba(10, 10, 10, 0.92)",border:"1px solid rgba(255, 215, 0, 0.4)",borderRadius:"8px",padding:"14px 18px",textAlign:"center",fontFamily:'"Courier New", "SF Mono", monospace',zIndex:"100",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",boxShadow:"0 0 24px rgba(255, 45, 45, 0.15), 0 0 8px rgba(255, 215, 0, 0.1)",maxWidth:"220px",minWidth:"140px"});mt.innerHTML='<div id="tt-char" style="font-size:36px;color:#FFD700;margin-bottom:6px;text-shadow:0 0 12px rgba(255,215,0,0.5)"></div><div id="tt-phrase" style="font-size:15px;color:#FF2D2D;margin-bottom:4px"></div><div id="tt-english" style="font-size:11px;color:#FFD700;opacity:0.65"></div>';document.body.appendChild(mt);function je(t,e,r){const o=Wt[t];if(!o){wt();return}document.getElementById("tt-char").textContent=t,document.getElementById("tt-phrase").textContent=o.phrase,document.getElementById("tt-english").textContent=o.english;const a=200,c=110;let l=e-a/2,i=r-c-30;l=Math.max(8,Math.min(window.innerWidth-a-8,l)),i<8&&(i=r+40),mt.style.left=l+"px",mt.style.top=i+"px",mt.style.opacity="1"}function wt(){mt.style.opacity="0"}function Qt(t,e){if(K.length===0){ot=-1,wt();return}const r=Math.min(D,F)*.4*h,o=Math.min(1,(f-pt)/1.2),a=at?1:I(o),c=at?Math.min(1,(f-pt)/.6):1,l=r*.06*(at?c:a);let i=-1,s=1/0;for(let g=0;g<K.length;g++){const M=K[g];if(!Wt[M.char])continue;const y=M.origZ*a+Math.sin(f*1.5+M.phase)*l,m=ie(M.baseX,M.baseY,y,lt),w=m.screenX-t,p=m.screenY-e,S=w*w+p*p;S<s&&(s=S,i=g)}const d=h*4;if(s>d*d){ot=-1,wt(),et!=="大吉大利"&&(Lt=et,et="大吉大利",vt=!0,kt=f);return}if(i!==ot){ot=i;const g=K[i],M=g.origZ*a+Math.sin(f*1.5+g.phase)*l,y=ie(g.baseX,g.baseY,M,lt);je(g.char,y.screenX,y.screenY);const m=Wt[g.char];if(m&&m.phrase){const w=m.phrase;et!==w&&(Lt=et,et=w,vt=!0,kt=f)}}}const we=[];function Oe(){for(let t=0;t<40;t++)we.push({col:Math.random()*D,row:Math.random()*F,vx:(Math.random()-.5)*.02,vy:(Math.random()-.5)*.02,char:L[Math.floor(Math.random()*L.length)],alpha:.03+Math.random()*.08,phase:Math.random()*Math.PI*2,changeTimer:Math.random()*200})}Oe();function Zt(t){for(const e of we){e.col+=e.vx,e.row+=e.vy,e.changeTimer--,e.col<0&&(e.col+=D),e.col>=D&&(e.col-=D),e.row<0&&(e.row+=F),e.row>=F&&(e.row-=F),e.changeTimer<=0&&(e.char=L[Math.floor(Math.random()*L.length)],e.changeTimer=100+Math.random()*200);const r=Math.floor(e.col),o=Math.floor(e.row),a=e.alpha+Math.sin(e.phase+t*1.5)*.02;me(r,o,999,e.char,255,215,0,Math.max(.01,a))}}function Ze(){n.save(),n.globalAlpha=.03,n.fillStyle="#fff";for(let t=0;t<k.height;t+=4*R)n.fillRect(0,t,k.width,1*R);n.restore()}function Ne(){n.save(),n.scale(R,R),n.fillStyle=x.bg,n.fillRect(0,0,window.innerWidth,window.innerHeight);const t=h;n.font=`${t}px ${_t}, "Courier New", "SF Mono", monospace`,n.textAlign="center",n.textBaseline="middle";for(let e=0;e<F;e++)for(let r=0;r<D;r++){const o=Gt[e*D+r];if(!o)continue;const a=ge+r*h+h/2,c=Pt+e*h+h/2;o.alpha>.3?(n.shadowColor=`rgba(${o.r}, ${o.g}, ${o.b}, ${o.alpha*.6})`,n.shadowBlur=h*o.alpha*1.2):(n.shadowColor="transparent",n.shadowBlur=0),n.fillStyle=`rgba(${o.r}, ${o.g}, ${o.b}, ${o.alpha})`,n.fillText(o.char,a,c)}n.shadowBlur=0,n.shadowColor="transparent",n.restore(),Ze()}function Ve(t){n.save(),n.scale(R,R);const r=Math.min(window.innerWidth,window.innerHeight)*.55,o=window.innerWidth/2,a=window.innerHeight/2;n.textAlign="center",n.textBaseline="middle",n.font=`${r}px ${_t}, serif`,n.globalAlpha=t*.3,n.shadowColor=x.glowGold,n.shadowBlur=r*.15,n.fillStyle=x.glowGold,n.fillText("福",o,a),n.globalAlpha=t,n.shadowColor=x.glowGold,n.shadowBlur=r*.06,n.fillStyle=x.glowGold,n.fillText("福",o,a),n.shadowBlur=0,n.restore()}function O(t,e,r,o,a,c){n.save(),n.scale(R,R);const l=a||Math.max(12,h*1.2),i=c||'"Courier New", "SF Mono", monospace';n.font=`${l}px ${i}`,n.textAlign="center",n.textBaseline="middle",n.fillStyle=r||x.glowGreen,n.globalAlpha=o??.6,n.shadowColor=r||x.glowGreen,n.shadowBlur=l*.4,n.fillText(t,window.innerWidth/2,window.innerHeight*e),n.shadowBlur=0,n.restore()}function te(){!rt||!Yt||!ht||(rt.render(Yt,ht),n.save(),n.setTransform(1,0,0,1,0,0),n.globalCompositeOperation="lighter",n.drawImage(rt.domElement,0,0),n.restore())}const Y=new De;function Me(t){if(!b)return;if(!t.length){b.count=0;return}const e=b.geometry.attributes.instanceColor,r=b.geometry.attributes.instanceAlpha,o=b.geometry.attributes.instanceUV,a=b.geometry.attributes.instanceScale,c=b.geometry.getAttribute("instanceColor").count,l=Math.min(t.length,c);for(let i=0;i<l;i++){const s=t[i];Y.position.set(s.x,-s.y,-s.z),Y.updateMatrix(),b.setMatrixAt(i,Y.matrix),e.setXYZ(i,s.r/255,s.g/255,s.b/255),r.setX(i,s.alpha);const d=s.fontIdx!=null&&it[s.char+"|"+s.fontIdx]||it[s.char];d&&o.setXY(i,d.u,d.v),a.setX(i,h*(s.size||1))}b.count=l,b.instanceMatrix.needsUpdate=!0,e.needsUpdate=!0,r.needsUpdate=!0,o.needsUpdate=!0,a.needsUpdate=!0,te()}let Q="arrival",B=0,f=0,xe=0,yt=null;function be(t){Q=t,xe=f,B=0,t==="draw"&&en(),t==="fortune"&&(yt&&yt.length>0?(de(yt),yt=null):de(),ue()),t==="fireworks"&&(ot=-1,wt(),ue())}function qe(){Zt(f)}function Ke(){const t=Math.min(1,B/1);Ve(t);const e=Math.min(1,B/1.5);O("新年纳福",.15,x.glowGold,e*.8,h*2),O("Embrace Fortune in the New Year",.2,x.glowGold,e*.5,h*1.1);const r=Math.min(1,Math.max(0,(B-1.5)/.5)),o=.4+Math.sin(f*3)*.2,a=f%3;let c=0;if(a<.9){const l=1-a/.9;c=-Math.abs(Math.sin(a/.9*Math.PI*3))*.012*l}O("↑  上滑抽签  ↑",.88+c,x.glowGold,r*o,h*1.6),O("Swipe Up to Draw Fortune",.92+c,x.glowGold,r*o,h*1.1)}let St=[],ut=[],gt=0;const U=x.fuExplodeDelay,ye=x.fuRiseDuration,Je=x.fuShrinkDuration,Qe=x.fuShrinkEndScale,fe=x.fuCameraPullbackDuration,tn=x.fuCameraReturnDuration,j=U+1.2,Z=j+1.1,Kt=Z+.4;function en(){if(St=[],ut=[],gt=0,yt=null,!Ot)return;const t=Math.min(D,F)*.4*h,e=t*.4,r=jt.map(a=>({x:a.nx*t*.5*a.aspect,y:a.ny*t*.5,z:(Math.random()-.5)*e,brightness:a.brightness})),o=Bt(D/2,F*.22);for(let a=0;a<r.length;a++){const c=r[a],l=Math.random()*Math.PI*2,i=t*(.8+Math.random()*1.2),s=t*(.1+Math.random()*.4);St.push({x:o.x,y:o.y,z:0,startX:o.x,startY:o.y,startZ:0,scatterX:o.x+Math.cos(l)*i,scatterY:o.y+Math.sin(l)*i*.6+s,scatterZ:(Math.random()-.5)*e*1.6,targetX:c.x,targetY:c.y,targetZ:c.z,char:L[Math.floor(Math.random()*L.length)],scrambleTimer:0,finalChar:Ht(c.brightness),brightness:c.brightness,phase:Math.random()*Math.PI*2,fontIdx:Math.random()<.7?Math.floor(Math.random()*N.length):null,active:!1})}}function nn(){Zt(f);const t=B;if(t<U){const o=Math.min(1,t/Math.max(.001,ye)),a=I(o),c=v(F*.5,F*.22,a),l=D/2,i=Bt(l,c);Math.random()<.6&&ut.push({x:i.x+(Math.random()-.5)*h*4,y:i.y+h*(.9+Math.random()*2.2),z:(Math.random()-.5)*h*3,vx:(Math.random()-.5)*h*.08,vy:h*(.08+Math.random()*.12),vz:(Math.random()-.5)*h*.06,char:L[Math.floor(Math.random()*L.length)],life:1,decay:.015+Math.random()*.025})}if(t>=U&&t<U+.15){gt=1-(t-U)/.15;for(const o of St)o.active=!0}else t>=U+.15&&(gt=0);if(t>=U){for(const o of St)if(o.active)if(t<j){const a=(t-U)/(j-U),c=1-Math.pow(1-a,2);o.x=v(o.startX,o.scatterX,c),o.y=v(o.startY,o.scatterY,c)+c*h*6,o.z=v(o.startZ,o.scatterZ,c);const l=a*h*.8;o.x+=Math.sin(o.phase+f*4)*l,o.y+=Math.cos(o.phase+f*3)*l,o.z+=Math.sin(o.phase*.7+f*3.2)*l*1.4,o.scrambleTimer-=1,o.scrambleTimer<=0&&(o.char=L[Math.floor(Math.random()*L.length)],o.scrambleTimer=2+Math.random()*3)}else if(t<Z){const a=(t-j)/(Z-j),c=I(a);o.x=v(o.scatterX,o.targetX,c),o.y=v(o.scatterY+h*6,o.targetY,c),o.z=v(o.scatterZ,o.targetZ,c);const l=(1-c)*h*.8;o.x+=Math.sin(o.phase+f*4)*l,o.y+=Math.cos(o.phase+f*3)*l,o.z+=Math.sin(o.phase*.7+f*3.2)*l*1.4,o.scrambleTimer-=1,o.scrambleTimer<=0&&(o.char=a>.4?o.finalChar:L[Math.floor(Math.random()*L.length)],o.scrambleTimer=2+a*12)}else{const a=Math.min(1,(t-Z)/Math.max(.001,Kt-Z)),c=I(a);o.x=v(o.x,o.targetX,c),o.y=v(o.y,o.targetY,c),o.z=v(o.z,o.targetZ,c),o.char=o.finalChar}}const e=(F*.5+2)*h;let r=0;for(let o=0;o<ut.length;o++){const a=ut[o];a.x+=a.vx,a.y+=a.vy,a.z+=a.vz,a.vx*=.98,a.vz*=.98,a.life-=a.decay,a.life>0&&a.y<e&&(ut[r++]=a)}if(ut.length=r,t>=Kt+.3){const o=an();yt=o.length>0?o:null,be("fortune")}}function an(){const t=[];for(const e of St){if(!e.active)continue;const r=Math.min(1,e.brightness+.08),o=e.finalChar||Ht(r);if(o===" ")continue;const a=$t(r);t.push({baseX:e.x,baseY:e.y,origZ:e.targetZ,char:o,fontIdx:e.fontIdx,r:a.r,g:a.g,b:a.b,alpha:.3+r*.7,lum:r,phase:e.phase})}return t}function on(t){const e=[];for(const a of ut)e.push({x:a.x,y:a.y,z:a.z,char:a.char,r:255,g:Math.floor(190+a.life*65),b:Math.floor(35+a.life*40),alpha:a.life*.68,size:.72+a.life*.35,glow:.9,blur:.8});const o=Math.min(D,F)*.4*h*.06;for(const a of St){if(!a.active)continue;const c=a.brightness,l=255,i=180+c*75,s=c*50;let d=l,g=i,M=s,y,m=.95+c*.45;if(t<j){const T=1-(t-U)/(j-U),C=Math.sin(f*25+a.phase*3)*.25*T;y=Math.min(1,Math.max(.1,.6+c*.3+C));const W=Math.sin(f*18+a.phase*2)*.3*T;m*=1+W}else if(t<Z){const T=(t-j)/(Z-j),C=Math.sin(f*8+a.phase)*.2*T;y=Math.min(1,Math.max(.2,.6+c*.3+C));const W=Math.sin(f*6+a.phase)*.15*T;m*=1+W}else{const u=Math.min(1,(t-Z)/(Kt-Z)),T=Math.min(1,c+.08),C=$t(T);d=v(l,C.r,u),g=v(i,C.g,u),M=v(s,C.b,u);const W=.3+T*.7,G=Math.min(1,(.5+c*.5)*(1+Math.sin(u*Math.PI)*.3));y=v(G,W,u),m=v(m,1.1,u)}let w=0;if(t>=Z)w=1;else if(t>j){const u=(t-j)/(Z-j);w=Math.max(0,u-.5)*2}const p=Math.sin(f*1.5+a.phase)*o,S=a.z+p*w;e.push({x:a.x,y:a.y,z:S,char:a.char,fontIdx:a.fontIdx,r:Math.round(d),g:Math.round(g),b:Math.round(M),alpha:y,size:m,glow:.7,blur:.65})}Me(e)}function sn(){const t=B;if(on(t),t<U){const e=Math.min(1,t/Math.max(.001,ye)),r=Math.min(1,t/Math.max(.001,Je)),o=I(e),a=I(r);n.save(),n.scale(R,R);const i=Math.min(window.innerWidth,window.innerHeight)*.55*v(1,Qe,a),s=window.innerWidth/2,d=window.innerHeight*v(.5,.2,o);n.textAlign="center",n.textBaseline="middle",n.font=`${i}px ${_t}, serif`;const g=1+e*2.5;n.globalAlpha=Math.min(1,.3*g),n.shadowColor=x.glowGold,n.shadowBlur=i*.2*g,n.fillStyle=x.glowGold,n.fillText("福",s,d),n.globalAlpha=1,n.shadowBlur=i*.08*g,n.fillText("福",s,d),n.shadowBlur=0,n.restore()}if(gt>0){n.save(),n.scale(R,R);const e=window.innerWidth/2,r=window.innerHeight*.22,o=Math.min(window.innerWidth,window.innerHeight)*.4*gt,a=n.createRadialGradient(e,r,0,e,r,o);a.addColorStop(0,`rgba(255, 255, 220, ${gt*.8})`),a.addColorStop(.4,`rgba(255, 215, 0, ${gt*.4})`),a.addColorStop(1,"rgba(255, 215, 0, 0)"),n.fillStyle=a,n.fillRect(0,0,window.innerWidth,window.innerHeight),n.restore()}}function rn(t){const e=Math.min(D,F)*.4,r=D/2,o=F/2;for(const a of jt){const c=Math.floor(r+a.nx*e*.5*a.aspect),l=Math.floor(o+a.ny*e*.5),i=Math.min(1,a.brightness+.08),s=Ht(i);if(s===" ")continue;const d=$t(i);me(c,l,0,s,d.r,d.g,d.b,Math.min(1,(.3+i*.7)*t))}}function ln(){Zt(f),Te(),vt&&f-kt>=.8&&(vt=!1,Lt=et),!bt&&B>6&&f-qt>Ue&&(qt=f,Xt())}function Ft(){return vt?et:Lt}function Tt(t){return t.length===2?t[0]+" "+t[1]:t.length===4?t[0]+" "+t[1]+" "+t[2]+" "+t[3]:t}function cn(t,e,r,o,a){const l=r*1.5;for(let i=0;i<14;i++){const s=i*137.508,d=(o*2.5+i/14)%1,g=Math.sin(d*Math.PI)*a*.6;if(g<.02)continue;const M=s+f*(1.2+i%3*.4),y=l*(.15+d*.85),m=t+Math.cos(M)*y,w=e+Math.sin(M)*y*.3,p=1+(1-d)*2.5;n.globalAlpha=g,n.fillStyle=x.glowGold,n.shadowColor=x.glowGold,n.shadowBlur=p*5,n.beginPath(),n.arc(m,w,p,0,Math.PI*2),n.fill()}}function hn(t,e){const r=h*5,o=1.3,a=window.innerWidth/2,c=window.innerHeight*.15,l=Ft(),i=[...l];if(t>=o){const p=Tt(Ft());O(p,.15,x.glowGold,.9,h*5,e);return}n.save(),n.scale(R,R),n.font=`${r}px ${e}, serif`,n.textAlign="center",n.textBaseline="middle";const s=Tt(l),d=n.measureText(s).width,g=[];let M=0;const y=i.map(p=>n.measureText(p).width),m=d-y.reduce((p,S)=>p+S,0),w=i.length>1?m/(i.length-1):0;for(let p=0;p<i.length;p++){const S=a-d/2+M+y[p]/2;g.push(S),M+=y[p]+w}for(let p=0;p<i.length;p++){const S=p*.2,u=o-S-.1,T=Math.max(0,Math.min(1,(t-S)/u));if(T<=0)continue;let C;T<.35?C=v(1.8,.93,I(T/.35)):T<.6?C=v(.93,1.06,I((T-.35)/.25)):C=v(1.06,1,I((T-.6)/.4));const W=Math.min(.9,T*3),G=1+Math.max(0,1-T*1.5)*2.5,_=Math.max(0,1-T*2.5)*r*.1;n.save(),n.translate(g[p],c+_),n.scale(C,C),n.globalAlpha=W*.35*G,n.fillStyle=x.glowGold,n.shadowColor=x.glowGold,n.shadowBlur=r*.25*G,n.fillText(i[p],0,0),n.globalAlpha=W,n.shadowBlur=r*.12,n.fillText(i[p],0,0),n.restore()}n.shadowBlur=0,n.shadowColor="transparent",n.restore()}function dn(t,e){const r=h*5,o=window.innerWidth/2,a=window.innerHeight*.15,c=et,l=[...c];n.save(),n.scale(R,R),n.font=`${r}px ${t}, serif`,n.textAlign="center",n.textBaseline="middle";const i=Tt(c),s=n.measureText(i).width,d=[];let g=0;const M=l.map(u=>n.measureText(u).width),y=s-M.reduce((u,T)=>u+T,0),m=l.length>1?y/(l.length-1):0;for(let u=0;u<l.length;u++){const T=o-s/2+g+M[u]/2;d.push(T),g+=M[u]+m}const w=f-kt,p=.15,S=.4;for(let u=0;u<l.length;u++){const T=u*p,C=w-T;if(C<0)continue;const W=Math.min(1,C/S);let G,_,H;if(W<.4){const P=W/.4;G=-r*.6*I(P),_=v(.3,1.1,I(P)),H=e*P}else if(W<.7){const P=(W-.4)/.3;G=v(-r*.6,r*.05,P*P),_=v(1.1,.95,P),H=e}else{const P=(W-.7)/.3;G=v(r*.05,0,I(P)),_=v(.95,1,I(P)),H=e}const dt=1+Math.max(0,1-W*2)*1.5;n.save(),n.translate(d[u],a+G),n.scale(_,_),n.globalAlpha=H*.4*dt,n.fillStyle=x.glowGold,n.shadowColor=x.glowGold,n.shadowBlur=r*.2*dt,n.fillText(l[u],0,0),n.globalAlpha=H,n.shadowBlur=r*.12,n.fillText(l[u],0,0),n.restore()}n.shadowBlur=0,n.shadowColor="transparent",n.restore()}function fn(t,e,r,o){n.save(),n.scale(R,R);const a=h*5,c=window.innerWidth/2,l=window.innerHeight*.15,i=e*.9,s=Ft(),d=[...s];n.font=`${a}px ${r}, serif`,n.textAlign="center",n.textBaseline="middle";const g=Tt(s),M=n.measureText(g).width,y=[];let m=0;const w=d.map(A=>n.measureText(A).width),p=M-w.reduce((A,z)=>A+z,0),S=d.length>1?p/(d.length-1):0;for(let A=0;A<d.length;A++)y.push(c-M/2+m+w[A]/2),m+=w[A]+S;n.font=`${a}px ${o}, serif`;const u=n.measureText(g).width,T=[];m=0;const C=d.map(A=>n.measureText(A).width),W=u-C.reduce((A,z)=>A+z,0),G=d.length>1?W/(d.length-1):0;for(let A=0;A<d.length;A++)T.push(c-u/2+m+C[A]/2),m+=C[A]+G;const _=.3,H=.1,dt=.7,P=.45,Vt=t<.15?t/.15:t>.85?(1-t)/.15:1;if(cn(c,l,a,t,i*Vt),t<_){const A=t/_;n.font=`${a}px ${r}, serif`,n.textAlign="center",n.textBaseline="middle";for(let z=0;z<d.length;z++){const tt=z*.2,X=Math.max(0,Math.min(1,(A-tt)/(1-tt))),V=Math.sin(f*35+z*2.7)*X*a*.05,E=Math.cos(f*28+z*1.9)*X*a*.035,ct=-X*X*a*.1,ft=i*(1-X*X),Mt=X*a*.025,At=y[z]+V,Ct=l+E+ct;Mt>.5&&(n.globalAlpha=ft*.3,n.fillStyle="#FF4444",n.shadowColor="#FF4444",n.shadowBlur=a*.12,n.fillText(d[z],At-Mt,Ct),n.fillStyle="#FFEE44",n.shadowColor="#FFEE44",n.fillText(d[z],At+Mt,Ct+Mt*.3)),n.globalAlpha=ft,n.fillStyle=x.glowGold,n.shadowColor=x.glowGold,n.shadowBlur=a*(.15+X*.25),n.fillText(d[z],At,Ct)}}if(t>=H&&t<dt){const A=(t-H)/(dt-H),z=v(18,3,A*A),tt=Math.floor(f*z),X=I(A),V=A<.15?A/.15:A>.7?(1-A)/.3:1;n.font=`${a}px ${A<.5?r:o}, serif`,n.textAlign="center",n.textBaseline="middle";for(let E=0;E<d.length;E++){const ct=L[(tt+E*13)%L.length],ft=Math.sin(f*5+E*2)*a*.035,Mt=Math.cos(f*3.5+E*2.5)*a*.02,At=v(y[E],T[E],X)+Mt,Ct=l+ft,oe=1+Math.sin(f*8+E)*.05;n.save(),n.translate(At,Ct),n.scale(oe,oe),n.globalAlpha=i*V*.7,n.fillStyle=x.glowGold,n.shadowColor=x.glowGold,n.shadowBlur=a*.2,n.fillText(ct,0,0),n.restore()}}if(t>=P){const A=(t-P)/(1-P);n.font=`${a}px ${o}, serif`,n.textAlign="center",n.textBaseline="middle";for(let z=0;z<d.length;z++){const tt=z*.15,X=Math.max(0,Math.min(1,(A-tt)/(1-tt))),V=I(X);let E;X<.45?E=V/.45*1.1:X<.7?E=v(1.1,.97,I((X-.45)/.25)):E=v(.97,1,I((X-.7)/.3));const ct=(1-V)*a*.12,ft=1+Math.sin(X*Math.PI)*.5;n.save(),n.translate(T[z],l+ct),n.scale(E,E),n.globalAlpha=i*V*.35*ft,n.fillStyle=x.glowGold,n.shadowColor=x.glowGold,n.shadowBlur=a*.3*ft,n.fillText(d[z],0,0),n.globalAlpha=i*V,n.shadowBlur=a*.12,n.fillText(d[z],0,0),n.restore()}}n.shadowBlur=0,n.shadowColor="transparent",n.restore()}function un(){const t=$e();st.length||nt.length||J.length?wn(t):te();const e=Math.min(1,B/.9);if(vt)dn(zt(),e*.9);else if(bt){const a=(f-bt.startTime)/1.2;if(a>=1){bt=null;const c=Tt(Ft());O(c,.15,x.glowGold,e*.9,h*5,zt())}else fn(a,e,bt.oldFont,zt())}else if(B<1.5)hn(B,zt());else{const o=Tt(Ft());O(o,.15,x.glowGold,e*.9,h*5,zt())}const r=Math.min(1,Math.max(0,(B-.5)/.9));O("万事如意 · 心想事成",.82,x.glowRed,r*.7,h*1.5),O("May all your wishes come true",.87,x.glowGold,r*.5,h*1)}const Ut=[{chars:"福禄寿喜财",r:255,g:45,b:45},{chars:"财富贵发金玉宝余丰盛利旺",r:255,g:215,b:0},{chars:"安康宁泰和平顺健",r:0,g:255,b:159},{chars:"喜乐欢庆禧祺嘉春",r:255,g:120,b:80},{chars:"德善仁义忠信孝慧恩",r:255,g:200,b:50},{chars:"爱合圆满美馨雅",r:255,g:130,b:180},{chars:"吉祥瑞如意祝运",r:180,g:255,b:80},{chars:"龙凤麟鹤华",r:255,g:180,b:50},{chars:"成升登高",r:80,g:220,b:255}],st=[],nt=[],J=[];let It=0,ee=0;function ve(){const t=Ut[Math.floor(Math.random()*Ut.length)],e=D*(.15+Math.random()*.7),r=e+(Math.random()-.5)*D*.12,o=Bt(e,F+2),a=Bt(r,F*(.1+Math.random()*.3)),c=(Math.random()-.5)*h*8;st.push({x:o.x,y:o.y,z:c,startX:o.x,startY:o.y,startZ:c,targetX:a.x,targetY:a.y,targetZ:(Math.random()-.5)*h*12,launchTime:f,duration:x.shellRiseDuration*(.85+Math.random()*.3),cat:t}),ee++}function gn(t){const e=25+Math.floor(Math.random()*35),{chars:r,r:o,g:a,b:c}=t.cat;for(let l=0;l<e;l++){const i=Math.PI*2*l/e+(Math.random()-.5)*.4,s=h*(.06+Math.random()*.1);J.push({x:t.x,y:t.y,z:t.z,vx:Math.cos(i)*s,vy:Math.sin(i)*s-h*.06,vz:(Math.random()-.5)*s*.5,char:r[Math.floor(Math.random()*r.length)],r:o,g:a,b:c,life:.6+Math.random()*.3,decay:.008+Math.random()*.008,gravity:h*(.001+Math.random()*.001),drag:.985,trailSegs:[],lastTrailTime:f})}}function Se(t,e){const r=Ut[Math.floor(Math.random()*Ut.length)],a=lt/(lt+0),c=(t-window.innerWidth/2)/a,l=(e-window.innerHeight/2)/a,i=(Math.random()-.5)*h*8,s=30+Math.floor(Math.random()*40),{chars:d,r:g,g:M,b:y}=r;for(let m=0;m<s;m++){const w=Math.PI*2*m/s+(Math.random()-.5)*.4,p=h*(.08+Math.random()*.12);J.push({x:c,y:l,z:i,vx:Math.cos(w)*p,vy:Math.sin(w)*p-h*.04,vz:(Math.random()-.5)*p*.6,char:d[Math.floor(Math.random()*d.length)],r:g,g:M,b:y,life:.7+Math.random()*.4,decay:.009+Math.random()*.009,gravity:h*(.0012+Math.random()*.0012),drag:.985,trailSegs:[],lastTrailTime:f})}}function ue(){st.length=0,nt.length=0,J.length=0,It=0,ee=0;for(let t=0;t<2;t++)ve()}function Te(){It--,It<=0&&(ve(),It=ee<3?40+Math.random()*30:70+Math.random()*80);const t=D*h*.5,e=F*h*.5;let r=0;for(let i=0;i<st.length;i++){const s=st[i],d=(f-s.launchTime)/s.duration,g=1-Math.pow(1-Math.min(d,1),2);s.x=v(s.startX,s.targetX,g),s.y=v(s.startY,s.targetY,g),s.z=v(s.startZ,s.targetZ,g);const M=Math.max(1,Math.floor((1-g)*2.8));for(let y=0;y<M;y++)nt.push({x:s.x+(Math.random()-.5)*h*.35,y:s.y+h*(.12+Math.random()*.32),z:s.z+(Math.random()-.5)*h*.6,vx:(Math.random()-.5)*h*.03,vy:h*(.07+Math.random()*.04),vz:(Math.random()-.5)*h*.03,char:"·",r:s.cat.r,g:s.cat.g,b:s.cat.b,life:.35+Math.random()*.45,decay:.03+Math.random()*.04});d>=1?gn(s):st[r++]=s}st.length=r;let o=0;for(let i=0;i<nt.length;i++){const s=nt[i];s.x+=s.vx,s.y+=s.vy,s.z+=s.vz,s.vx*=.95,s.vz*=.95,s.life-=s.decay,s.life>0&&s.y<=e+h*3&&(nt[o++]=s)}nt.length=o;const a=.06,c=14;let l=0;for(let i=0;i<J.length;i++){const s=J[i];s.vx*=s.drag,s.vy*=s.drag,s.vz*=s.drag,s.vy+=s.gravity,s.x+=s.vx,s.y+=s.vy,s.z+=s.vz,s.life-=s.decay,f-s.lastTrailTime>=a&&s.life>.05&&(s.trailSegs.push({x:s.x,y:s.y,z:s.z}),s.lastTrailTime=f,s.trailSegs.length>c&&s.trailSegs.shift()),s.life>0&&s.y<=e+h*6&&s.x>=-t-h*8&&s.x<=t+h*8&&s.z>=-lt*.9&&s.z<=lt*1.5&&(J[l++]=s)}J.length=l}function pn(){Zt(f),rn(.15+Math.sin(f*.8)*.05),Te()}function mn(){const t=[];for(const e of st)t.push({x:e.x,y:e.y,z:e.z,char:"·",r:e.cat.r,g:e.cat.g,b:e.cat.b,alpha:.9,size:1,glow:1,blur:.9});for(const e of nt)t.push({x:e.x,y:e.y,z:e.z,char:e.char,r:e.r,g:e.g,b:e.b,alpha:e.life*.7,size:.7+e.life*.3,glow:.9,blur:.85});for(const e of J){const r=Math.max(.05,e.life*e.life);t.push({x:e.x,y:e.y,z:e.z,char:e.char,r:e.r,g:e.g,b:e.b,alpha:r,size:.92+r*.5,glow:.65,blur:.62});const o=e.trailSegs.length;for(let a=0;a<o;a++){const c=e.trailSegs[a],l=o>1?a/(o-1):1,i=r*(.2+l*.6);t.push({x:c.x,y:c.y,z:c.z,char:e.char,r:e.r,g:e.g,b:e.b,alpha:i,size:.6+l*.35,glow:.5,blur:.5})}}Me(t)}function wn(t){if(!b)return;const e=b.geometry.attributes.instanceColor,r=b.geometry.attributes.instanceAlpha,o=b.geometry.attributes.instanceUV,a=b.geometry.attributes.instanceScale,c=e.count;let l=t;for(const i of st){if(l>=c)break;Y.position.set(i.x,-i.y,-i.z),Y.updateMatrix(),b.setMatrixAt(l,Y.matrix),e.setXYZ(l,i.cat.r/255,i.cat.g/255,i.cat.b/255),r.setX(l,.9);const s=it["·"];s&&o.setXY(l,s.u,s.v),a.setX(l,h),l++}for(const i of nt){if(l>=c)break;Y.position.set(i.x,-i.y,-i.z),Y.updateMatrix(),b.setMatrixAt(l,Y.matrix),e.setXYZ(l,i.r/255,i.g/255,i.b/255),r.setX(l,i.life*.7);const s=it[i.char];s&&o.setXY(l,s.u,s.v),a.setX(l,h*(.7+i.life*.3)),l++}for(const i of J){if(l>=c)break;const s=Math.max(.05,i.life*i.life);Y.position.set(i.x,-i.y,-i.z),Y.updateMatrix(),b.setMatrixAt(l,Y.matrix),e.setXYZ(l,i.r/255,i.g/255,i.b/255),r.setX(l,s);const d=it[i.char];d&&o.setXY(l,d.u,d.v),a.setX(l,h*(.92+s*.5)),l++;const g=i.trailSegs.length;for(let M=0;M<g&&!(l>=c);M++){const y=i.trailSegs[M],m=g>1?M/(g-1):1,w=s*(.2+m*.6),p=h*(.6+m*.35);Y.position.set(y.x,-y.y,-y.z),Y.updateMatrix(),b.setMatrixAt(l,Y.matrix),e.setXYZ(l,i.r/255,i.g/255,i.b/255),r.setX(l,w),d&&o.setXY(l,d.u,d.v),a.setX(l,p),l++}}b.count=l,b.instanceMatrix.needsUpdate=!0,e.needsUpdate=!0,r.needsUpdate=!0,o.needsUpdate=!0,a.needsUpdate=!0,te()}function Mn(){mn();const t=Math.min(1,B/1.5);if(O("恭喜发财",.08,x.glowGold,t*.7,h*2),O("Prosperity & Fortune",.13,x.glowGold,t*.4,h*1),B>3){const e=Math.min(1,(B-3)/.5),r=.3+Math.sin(f*3)*.2;O("↑  继续  ↑",.94,x.glowGold,e*r,h*1)}}let ne=0,ae=0,Ae=0;k.addEventListener("touchstart",t=>{const e=t.touches[0];ne=e.clientX,ae=e.clientY,Ae=performance.now(),Q==="fortune"&&Qt(e.clientX,e.clientY)},{passive:!0});k.addEventListener("touchmove",t=>{const e=t.touches[0];Math.abs(e.clientX-ne)>10||Math.abs(e.clientY-ae)>10,Q==="fortune"&&Qt(e.clientX,e.clientY)},{passive:!0});k.addEventListener("touchend",t=>{const e=t.changedTouches[0].clientX-ne,r=ae-t.changedTouches[0].clientY,o=performance.now()-Ae;ot=-1,wt(),Q==="fortune"&&Math.abs(e)>50&&Math.abs(e)>Math.abs(r)&&o<500?Xt():r>50&&o<500?Nt():Math.abs(e)<15&&Math.abs(r)<15&&o<300&&Se(t.changedTouches[0].clientX,t.changedTouches[0].clientY)},{passive:!0});k.addEventListener("mousemove",t=>{Q==="fortune"&&Qt(t.clientX,t.clientY)});k.addEventListener("mouseleave",()=>{ot=-1,wt()});let Ce=0,Jt=!1;k.addEventListener("mousedown",t=>{Ce=t.clientY,Jt=!0});k.addEventListener("mouseup",t=>{if(Jt){const e=Ce-t.clientY;e>50?Nt():Math.abs(e)<10&&Se(t.clientX,t.clientY)}Jt=!1});k.addEventListener("wheel",t=>{t.deltaY<-30&&Nt()},{passive:!0});window.addEventListener("keydown",t=>{(t.code==="Space"||t.code==="ArrowUp")&&(t.preventDefault(),Nt()),Q==="fortune"&&(t.code==="ArrowLeft"&&(t.preventDefault(),Xt()),t.code==="ArrowRight"&&(t.preventDefault(),Xt()))});function Nt(){Q==="arrival"&&Ot&&be("draw")}const xn=performance.now();function ze(t){switch(f=(t-xn)/1e3,B=f-xe,He(),Q){case"arrival":qe();break;case"draw":nn();break;case"fortune":ln();break;case"fireworks":pn();break}let e=0;if(Q==="draw"){if(B<U)if(B<fe){const r=Math.min(1,B/Math.max(.001,fe));e=-I(r)*h*3}else e=-h*3;else{const r=Math.min(1,(B-U)/Math.max(.001,tn));e=-(1-I(r))*h*3}Pt+=e}switch(Ne(),e!==0&&(Pt-=e),b&&(b.count=0),Q){case"arrival":Ke();break;case"draw":sn();break;case"fortune":un();break;case"fireworks":Mn();break}requestAnimationFrame(ze)}requestAnimationFrame(ze);
